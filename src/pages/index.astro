---
import { SITE_TITLE, SITE_DESCRIPTION } from 'src/consts/SiteData.js';
import MainLayout from 'src/layouts/MainLayout.astro';
import GridBackground from 'src/components/jsx/gridBackground/GridBackground/GridBackground.jsx';
import HeroSection from 'src/components/jsx/home/HeroSection/HeroSection.jsx';
import LatestPostsSection from 'src/components/jsx/home/LatestPostsSection/LatestPostsSection.jsx';
import AboutSection from 'src/components/jsx/home/AboutSection/AboutSection.jsx';
import JourneySection from 'src/components/jsx/home/JourneySection/JourneySection.jsx';
import GitHubStats from 'src/components/jsx/home/GitHubStats/GitHubStats.jsx';
import { getCollection } from 'astro:content';
import portfolioData from 'src/data/portfolio/portfolio.json';
import PortfolioPreview from 'src/components/jsx/home/PortfolioPreview/PortfolioPreview';
import { getRepoMetadata, getCommitCount } from 'src/lib/github.js';
import ContentContainer from 'src/components/jsx/ContentContainer/ContentContainer';
import { journeyData } from 'src/data/journey/journey.js';

const latestPosts = (await getCollection('blog'))
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
	.slice(0, 2)
	.map((post) => ({
		title: post.data.title,
		description: post.data.description,
		pubDate: new Date(post.data.pubDate),
		heroImage: post.data.heroImage,
		slug: post.id,
		readTime: post.data.readTime,
		tags: post.data.tags,
	}));

const aboutParagraphs = [
	'I specialize in full-stack web development, with a focus on modern JavaScript frameworks and tools. My goal is to create performant, accessible, and user-friendly web applications.',
	"When I'm not coding, you can find me writing technical articles, contributing to open source projects, or exploring new technologies to stay at the forefront of web development.",
];

const featuredProjects = portfolioData.projects.filter(
	(project) => project.featured
);

// Fetch GitHub data
const metadata = await getRepoMetadata();
const commitCount = await getCommitCount();
---

<MainLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
	<GridBackground client:load />
	<!-- <DarkModeApp client:load /> -->

	<ContentContainer client:load>
		<HeroSection
			client:load
			title="Daniel Tenzler - Astro/React Github-Pages Website"
			description="Hey, I'm Daniel. I am a Junior Web & Native App Software Developer. This website serves as my personal portfolio and playground."
		/>

		<PortfolioPreview client:load projects={featuredProjects} />

		<LatestPostsSection client:load posts={latestPosts} />

		<AboutSection client:load paragraphs={aboutParagraphs} />

		<!-- <JourneySection client:visible data={journeyData} /> -->

		<GitHubStats
			client:load
			metadata={metadata}
			commitCount={commitCount}
		/>
	</ContentContainer>
</MainLayout>

<style>
	:global(.bg-accent) {
		background-color: var(--accent);
	}
	:global(.bg-accent-dark) {
		background-color: var(--accent-dark);
	}
	:global(.text-accent) {
		color: var(--accent);
	}
	:global(.hover\:text-accent:hover) {
		color: var(--accent);
	}
	:global(.hover\:bg-accent-dark:hover) {
		background-color: var(--accent-dark);
	}
	:global(.focus\:ring-accent:focus) {
		--tw-ring-color: var(--accent);
	}
</style>
